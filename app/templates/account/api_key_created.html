{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-md-8 col-lg-6">
    <div class="card border-success">
      <div class="card-body">
        <div class="text-center mb-4">
          <i class="bi bi-check-circle text-success" style="font-size: 4rem;"></i>
          <h2 class="mt-3">{{ _('API Key Created') }}</h2>
          <p class="text-muted">{{ _('Copy your API key now - you won\'t see it again!') }}</p>
        </div>

        <div class="alert alert-warning">
          <strong>⚠️ {{ _('Important') }}:</strong> 
          {{ _('This is the only time you will see this key. Store it securely.') }}
        </div>

        <div class="mb-3">
          <label class="form-label"><strong>{{ _('Key Name') }}:</strong></label>
          <p>{{ key_name }}</p>
        </div>

        <div class="mb-3">
          <label class="form-label"><strong>{{ _('Your API Key') }}:</strong></label>
          <div class="input-group">
            <input type="text" class="form-control font-monospace" 
                   id="apiKeyValue" 
                   value="{{ api_key }}" 
                   readonly>
            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard()">
              <i class="bi bi-clipboard"></i> {{ _('Copy') }}
            </button>
          </div>
        </div>

        <div class="card bg-light mt-4">
          <div class="card-body">
            <h6>{{ _('Quick Start') }}</h6>
            <p class="mb-2">{{ _('Use this key in your API requests') }}:</p>
            <pre class="mb-0"><code>curl -H "Authorization: Bearer {{ api_key }}" \
  {{ request.url_root }}api/v1/me</code></pre>
          </div>
        </div>

        <div class="d-grid gap-2 mt-4">
          <button class="btn btn-success" onclick="confirmCopied()">
            <i class="bi bi-check-lg"></i> {{ _('I\'ve Copied the Key') }}
          </button>
          <a href="{{ url_for('account.api_keys') }}" class="btn btn-outline-secondary">
            {{ _('Back to API Keys') }}
          </a>
        </div>

        <div class="alert alert-secondary mt-4">
          <small>
            <strong>{{ _('Security Tips') }}:</strong>
            <ul class="mb-0">
              <li>{{ _('Store in environment variables, not in code') }}</li>
              <li>{{ _('Never commit API keys to version control') }}</li>
              <li>{{ _('Regenerate immediately if compromised') }}</li>
            </ul>
          </small>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function copyToClipboard() {
  const input = document.getElementById('apiKeyValue');
  input.select();
  input.setSelectionRange(0, 99999); // For mobile devices
  
  try {
    document.execCommand('copy');
    
    // Show success feedback
    const btn = event.target.closest('button');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="bi bi-check-lg"></i> {{ _('Copied!') }}';
    btn.classList.remove('btn-outline-secondary');
    btn.classList.add('btn-success');
    
    setTimeout(() => {
      btn.innerHTML = originalHTML;
      btn.classList.remove('btn-success');
      btn.classList.add('btn-outline-secondary');
    }, 2000);
  } catch (err) {
    alert('{{ _('Failed to copy. Please copy manually.') }}');
  }
}

function confirmCopied() {
  if (confirm('{{ _('Have you saved your API key? You won\'t be able to see it again.') }}')) {
    window.location.href = '{{ url_for('account.api_keys') }}';
  }
}

// Warn on page leave if key not confirmed
let confirmed = false;
window.addEventListener('beforeunload', function (e) {
  if (!confirmed) {
    e.preventDefault();
    e.returnValue = '{{ _('Make sure you\'ve copied your API key!') }}';
  }
});

// Disable warning if "I've Copied" is clicked
document.querySelector('.btn-success').addEventListener('click', function() {
  confirmed = true;
});
</script>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
{% endblock %}
